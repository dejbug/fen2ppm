image: Visual Studio 2013

install:
  - ps: $fileContent = "-----BEGIN RSA PRIVATE KEY-----`n"
  - ps: $fileContent += $env:priv_key.Replace(' ', "`n")
  - ps: $fileContent += "`n-----END RSA PRIVATE KEY-----`n"
  - ps: Set-Content $env:userprofile\.ssh\id_rsa $fileContent
  - git submodule update --init --recursive

version: build-{build}

skip_tags: true
test: off
max_jobs: 1
shallow_clone: true

build_script:
  - cmd: call appveyor.bat

cache:
  - upx-3.96-win64.zip

artifacts:
  - path: build

deploy:
  - provider: GitHub
    release: $(APPVEYOR_PROJECT_NAME)-$(APPVEYOR_REPO_TAG_NAME)-$(APPVEYOR_BUILD_VERSION)
    description: Automated release.
    auth_token:
      secure: GlPci9QnLJxVkwdcLb6l1v0Std1gZw7kj+9Oyg/emy5H8Npnf8w6B9yXMH/DhNq2
    artifact: deploy\$(APPVEYOR_PROJECT_NAME)-$(APPVEYOR_REPO_TAG_NAME).zip
    draft: false
    prerelease: true
    on:
      branch: master           # release from master branch only
      appveyor_repo_tag: false # deploy on tag push only
